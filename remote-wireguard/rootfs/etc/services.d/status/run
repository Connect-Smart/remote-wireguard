#!/usr/bin/with-contenv bashio
# ==============================================================================
# Home Assistant Community Add-on: WireGuard Client
# Shows current WireGuard status
# ==============================================================================
INTERFACE="cswg0"
DEFAULT_INTERVAL="30"

get_monitor_interval() {
    local interval="${DEFAULT_INTERVAL}"
    if bashio::config.has_value "monitor_interval"; then
        interval="$(bashio::config "monitor_interval")"
    fi
    if ! [[ "${interval}" =~ ^[0-9]+$ ]] || [[ "${interval}" -lt 5 ]]; then
        bashio::log.warning "monitor_interval ongeldig (${interval}); standaard ${DEFAULT_INTERVAL}s wordt gebruikt."
        interval="${DEFAULT_INTERVAL}"
    fi
    printf '%s' "${interval}"
}

MONITOR_INTERVAL="$(get_monitor_interval)"
sleep "${MONITOR_INTERVAL}"
bashio::log.info "Requesting current status from WireGuard Client..."
if [[ "${__BASHIO_LOG_LEVEL}" -ge "${__BASHIO_LOG_LEVEL_INFO}" ]]; then
    exec wg show "${INTERFACE}"
fi
